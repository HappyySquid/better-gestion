<div class="gestion-linge-container">
  <div class="header-section">
    <div class="header-content">
      <button class="btn-back" routerLink="/dashboard">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Retour au menu
      </button>
      <h1>Gestion du Linge</h1>
      <button class="btn-print" (click)="printStock()" title="Imprimer le stock">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 6 2 18 2 18 9"></polyline>
          <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
          <rect x="6" y="14" width="12" height="8"></rect>
        </svg>
        Imprimer
      </button>
    </div>
  </div>


  <div class="content-grid">
    <!-- Stock Global -->
    <div class="card stock-card">
      <h2>Stock Global</h2>
      <div class="stock-list">
        <div class="stock-item" *ngFor="let item of stockItems">
          <span class="item-label">{{ item.label }}</span>
          <span class="item-value">{{ stock[item.key] ?? 0 }}</span>
        </div>
      </div>
    </div>

    <!-- Kits Disponibles -->
    <div class="card kits-card">
      <h2>Kits Disponibles</h2>
      <div class="kits-list">
        <div class="kit-item" *ngFor="let kit of kitTypes">
          <div class="kit-info">
            <span class="kit-label">{{ kit.label }}</span>
            <span class="kit-description">{{ kit.description }}</span>
          </div>
          <span class="kit-value">{{ kits[kit.key] ?? 0 }}</span>
        </div>
      </div>
    </div>

    <!-- Kits Maximum Possibles -->
    <div class="card max-kits-card">
      <h2>Kits Maximum Possibles</h2>
      <div class="max-kits-list">
        <div class="max-kit-item" *ngFor="let kit of kitTypes">
          <span class="max-kit-label">{{ kit.label }}</span>
          <span class="max-kit-value">{{ maxKits[kit.key] ?? 0 }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="actions-section">
    <!-- Gestion du Stock -->
    <div class="card action-card">
      <h2>Gérer le Stock</h2>
      <form [formGroup]="stockForm" (ngSubmit)="onStockSubmit()" class="action-form">
        <div class="form-group">
          <label for="item">Article</label>
          <select id="item" formControlName="item" class="form-control">
            <option value="">Sélectionner un article</option>
            <option *ngFor="let item of stockItems" [value]="item.key">{{ item.label }}</option>
          </select>
        </div>

        <div class="form-group">
          <label for="quantity">Quantité</label>
          <input id="quantity" type="number" formControlName="quantity" min="1" class="form-control" />
        </div>

        <div class="form-group">
          <label for="operation">Opération</label>
          <select id="operation" formControlName="operation" class="form-control">
            <option value="add">Ajouter</option>
            <option value="remove">Retirer</option>
          </select>
        </div>

        <button type="submit" class="btn-primary" [disabled]="isLoading || stockForm.invalid">
          {{ isLoading ? 'En cours...' : 'Valider' }}
        </button>
      </form>
    </div>

    <!-- Ajouter un Kit -->
    <div class="card action-card">
      <h2>Ajouter un Kit</h2>
      <form [formGroup]="kitForm" (ngSubmit)="onAddKit()" class="action-form">
        <div class="form-group">
          <label for="kitType">Type de Kit</label>
          <select id="kitType" formControlName="kitType" class="form-control">
            <option *ngFor="let kit of kitTypes" [value]="kit.key">{{ kit.label }}</option>
          </select>
          <small class="form-help" *ngIf="getSelectedKitDescription()">
            {{ getSelectedKitDescription() }}
          </small>
        </div>

        <div class="form-group">
          <label for="kitQuantity">Quantité</label>
          <input id="kitQuantity" type="number" formControlName="quantity" min="1" class="form-control" />
          <small class="form-help">
            Maximum possible : {{ getMaxKitForSelected() }}
          </small>
        </div>

        <button type="submit" class="btn-primary" [disabled]="isLoading || kitForm.invalid">
          {{ isLoading ? 'En cours...' : 'Ajouter le Kit' }}
        </button>
      </form>
    </div>

    <!-- Retirer un Kit -->
    <div class="card action-card">
      <h2>Retirer un Kit (Donné au client)</h2>
      <form [formGroup]="removeKitForm" (ngSubmit)="onRemoveKit()" class="action-form">
        <div class="form-group">
          <label for="removeKitType">Type de Kit</label>
          <select id="removeKitType" formControlName="kitType" class="form-control">
            <option *ngFor="let kit of kitTypes" [value]="kit.key">{{ kit.label }}</option>
          </select>
        </div>

        <div class="form-group">
          <label for="removeKitQuantity">Quantité</label>
          <input id="removeKitQuantity" type="number" formControlName="quantity" min="1" class="form-control" />
          <small class="form-help">
            Disponible : {{ getAvailableKitForSelected() }}
          </small>
        </div>

        <button type="submit" class="btn-danger" [disabled]="isLoading || removeKitForm.invalid">
          {{ isLoading ? 'En cours...' : 'Retirer le Kit' }}
        </button>
      </form>
    </div>
  </div>
</div>
